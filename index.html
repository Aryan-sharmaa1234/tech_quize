<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>UPSC MCQ Test Series ‚Äì Boost Your Prep Daily!</title>
    <!-- Tone.js removed. Using local audio files instead. -->
    <style>
      :root {
        --bg: #0f1724;
        --card: #0b1320;
        --muted: #98a0b3;
        --accent: #06b6d4;
        --correct: #16a34a;
        --wrong: #dc2626;
        --explanation-bg: #1e293b; /* New color for explanation background */
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto,
          "Helvetica Neue", Arial;
        background: linear-gradient(180deg, #071124 0%, #081426 100%);
        color: #e6eef6;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 28px;
      }

      .container {
        width: 100%;
        max-width: 760px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(255, 255, 255, 0.01)
        );
        border-radius: 12px;
        padding: 22px;
        box-shadow: 0 10px 30px rgba(2, 6, 23, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.03);
      }

      header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 18px;
      }
      header h1 {
        font-size: 18px;
        margin: 0;
        letter-spacing: 0.2px;
      }
      header p {
        margin: 0;
        color: var(--muted);
        font-size: 13px;
      }

      .card {
        background: var(--card);
        padding: 20px;
        border-radius: 10px;
      }
      .question {
        font-size: 20px;
        margin-bottom: 14px;
      }
      .meta {
        color: var(--muted);
        font-size: 13px;
        margin-bottom: 12px;
      }

      .options {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }
      .opt {
        background: #1e293b;
        color: #ffffff;
        border: 1px solid #475569;
        padding: 12px 10px;
        border-radius: 8px;
        /* Removed cursor: pointer */
        text-align: left;
        transition: all 200ms ease;
        font-size: 15px;
        user-select: none;
      }
      .opt:hover {
        /* Removed transform effect for non-interactive mode */
        transform: none;
      }
      .opt.disabled {
        cursor: default;
        opacity: 0.9;
      }
      .opt.correct {
        background: linear-gradient(
          90deg,
          rgba(22, 163, 74, 0.12),
          rgba(22, 163, 74, 0.06)
        );
        border-color: rgba(22, 163, 74, 0.6);
        box-shadow: 0 6px 18px rgba(16, 185, 129, 0.08);
      }
      .opt.wrong {
        background: linear-gradient(
          90deg,
          rgba(220, 38, 38, 0.08),
          rgba(220, 38, 38, 0.04)
        );
        border-color: rgba(220, 38, 38, 0.6);
        box-shadow: 0 6px 18px rgba(220, 38, 38, 0.06);
      }

      .controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 16px;
      }
      .btn {
        padding: 8px 12px;
        border-radius: 8px;
        border: none;
        /* Removed cursor: pointer */
        font-weight: 600;
      }
      .btn.primary {
        background: var(--accent);
        color: #052225;
      }
      .btn.ghost {
        background: transparent;
        color: var(--muted);
        border: 1px solid rgba(255, 255, 255, 0.03);
      }

      .score {
        color: var(--muted);
        font-size: 16px;
        /* Enhanced visual for timer */
        font-weight: 600;
        color: var(--accent);
      }

      /* --- New Explanation Style --- */
      #explanation {
        margin-top: 20px;
        padding: 15px;
        background-color: var(--explanation-bg);
        border-left: 5px solid var(--accent);
        border-radius: 4px;
        font-size: 14px;
        color: #d1d5db; /* Light gray text */
        display: none; /* Hide by default */
      }
      #explanation strong {
        color: var(--accent);
      }

      @media (max-width: 520px) {
        .options {
          grid-template-columns: 1fr;
        }
        .question {
          font-size: 18px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Local Audio Elements for sound effects -->
    <!-- stopwatch.mp3 is still included but not played by the script -->
    <audio id="stopwatch-sound" src="stopwatch.mp3" preload="auto"></audio>
    <audio id="true-sound" src="true.mp3" preload="auto"></audio>

    <div class="container" role="main">
      <header>
        <div style="display: flex; flex-direction: column">
          <h1>UPSC MCQ Test Series ‚Äì Boost Your Prep Daily! üí°üß†</h1>
          <p>Practice quick MCQs - Comment your score</p>
        </div>
      </header>

      <section class="card" aria-labelledby="qtitle">
        <div class="meta">
          Question <span id="qIndex">1</span>/<span id="qTotal">1</span>
        </div>
        <div id="qtitle" class="question">Loading question‚Ä¶</div>

        <div class="options" id="options" role="list"></div>

        <div class="controls">
          <div class="score" id="feedback">Loading...</div>
          <div>
            <button class="btn ghost" id="showAnswerBtn" disabled>
              Show Answer
            </button>
            <button class="btn primary" id="nextBtn" disabled>Next</button>
          </div>
        </div>

        <div id="explanation"></div>
      </section>
    </div>

    <script>
      // 1. Declare 'questions' globally but do not initialize it with data yet
      let questions = [];

      // UI elements
      const qIndexEl = document.getElementById("qIndex");
      const qTotalEl = document.getElementById("qTotal");
      const qtitle = document.getElementById("qtitle");
      const optionsEl = document.getElementById("options");
      const feedback = document.getElementById("feedback");
      const nextBtn = document.getElementById("nextBtn");
      const showAnswerBtn = document.getElementById("showAnswerBtn");
      const explanationEl = document.getElementById("explanation");

      // Audio elements references
      const stopwatchSound = document.getElementById("stopwatch-sound");
      const trueSound = document.getElementById("true-sound");

      // Constants
      const COUNTDOWN_TIME = 5; // The initial count
      const REVEAL_PAUSE_TIME = 2; // Pause duration after answer is revealed
      const NEXT_QUESTION_DELAY = 3; // Delay before moving to next question (unused in final logic, but kept for clarity)

      let current = 0;
      let timerId;

      /**
       * Plays a specified audio file using HTML5 Audio.
       * @param {string} soundName 'stopwatch' or 'true'
       */
      function playSound(soundName) {
        let audio;
        if (soundName === "stopwatch") {
          audio = stopwatchSound;
        } else if (soundName === "true") {
          audio = trueSound;
        } else {
          return;
        }

        if (audio) {
          // Check if audio element is loaded
          if (audio.readyState < 2) {
            console.warn("Audio not yet ready or loaded. Skipping play.");
            return;
          }
          // Stop and rewind before playing to allow multiple quick plays (like ticking)
          audio.pause();
          audio.currentTime = 0;
          // Play returns a promise, use .catch to handle possible browser blocks
          audio.play().catch((e) => {
            // This usually means the browser blocked autoplay. Inform the user.
            console.error(
              "Audio playback blocked. Please click anywhere on the page once to enable sound:",
              e.message
            );
          });
        }
      }

      /**
       * New asynchronous function to fetch the question data
       */
      async function loadQuestions() {
        try {
          // Using "quiz_data.json"
          const response = await fetch("quiz_data.json");
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          questions = await response.json();

          if (questions.length === 0) {
            qtitle.textContent = "Error: No questions found in JSON file.";
            feedback.textContent = "Test failed to load.";
            return;
          }

          // Start the quiz once data is loaded
          renderQuestion();
        } catch (error) {
          console.error("Could not load questions:", error);
          qtitle.textContent =
            "Error loading quiz data. Please ensure 'quiz_data.json' is available and correctly formatted.";
          feedback.textContent = "Load failed.";
        }
      }

      /**
       * Function to display the correct answer and explanation immediately,
       * play the sound, and then start the pause for transition.
       */
      function showAnswer() {
        if (questions.length === 0) return; // Guard against no data
        const item = questions[current];
        const correct = item.correct;

        // *** Action 1: Play true.mp3 immediately ***
        playSound("true");

        // Determine the correct option text in both languages
        const correctOptionHindi = item.options_hindi[correct];
        const correctOptionEnglish = item.options_english[correct];
        const combinedCorrectOption = `${correctOptionHindi} (${correctOptionEnglish})`;

        // Highlight correct answer
        const nodes = optionsEl.querySelectorAll(".opt");
        nodes.forEach((n) => {
          if (Number(n.dataset.index) === correct) {
            n.classList.add("correct");
          }
        });

        // Combine and show explanation in both languages
        const combinedExplanation = `
            <strong>‡§π‡§ø‡§Ç‡§¶‡•Ä:</strong> ${item.explanation_hindi}<br><br>
            <strong>English:</strong> ${item.explanation_english}
        `;

        explanationEl.innerHTML = `
            <strong>‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ (Correct Answer): ${combinedCorrectOption}</strong>
            <hr style="border-color: #2e3b4d; margin: 8px 0;">
            <strong>‡§∏‡•ç‡§™‡§∑‡•ç‡§ü‡•Ä‡§ï‡§∞‡§£ (Explanation):</strong>
            ${combinedExplanation}
        `;
        explanationEl.style.display = "block";
        feedback.textContent =
          "Time Up! Answer Revealed ‚úÖ Moving to next question...";

        // *** Action 2: Start the REVEAL_PAUSE_TIME countdown for next question ***
        let timeRemaining = REVEAL_PAUSE_TIME;
        clearInterval(timerId); // Clear previous timer

        timerId = setInterval(() => {
          timeRemaining--;
          if (timeRemaining <= 0) {
            clearInterval(timerId);
            moveToNextQuestion();
          } else {
            // Update feedback for the transition pause
            feedback.textContent = `Time Up! Answer Revealed ‚úÖ Moving in ${timeRemaining}s...`;
          }
        }, 1000);
      }

      // Removed startRevealPause function as its logic is now merged into showAnswer

      // Function to move to the next question
      function moveToNextQuestion() {
        current = (current + 1) % questions.length;
        if (current === 0) {
          feedback.textContent = "Test Series Finished! Restarting...";
          setTimeout(renderQuestion, 3000); // Give a moment before restarting
        } else {
          renderQuestion();
        }
      }

      // Function to start the countdown for the current question
      function startQuestionTimer() {
        let timeRemaining = COUNTDOWN_TIME;
        clearInterval(timerId); // Clear any existing timer

        // Removed: playSound('stopwatch'); - as requested by the user

        timerId = setInterval(() => {
          timeRemaining--;

          if (timeRemaining <= 0) {
            clearInterval(timerId);
            // Time's up, call showAnswer directly to reveal and play sound immediately
            showAnswer();
          } else {
            // Update feedback with remaining time
            feedback.textContent = `Time left to guess: ${timeRemaining}s ‚è≥`;
          }
        }, 1000);
      }

      // Main function to render a question
      function renderQuestion() {
        if (questions.length === 0) return; // Guard against no data

        const item = questions[current];
        qIndexEl.textContent = current + 1;
        qTotalEl.textContent = questions.length;

        // Use q_hindi and q_english for the question title
        qtitle.textContent = `${item.q_hindi} (${item.q_english})`;

        optionsEl.innerHTML = "";

        // Hide and clear explanation
        explanationEl.style.display = "none";
        explanationEl.innerHTML = "";

        // Reset feedback before timer starts
        feedback.textContent = `Time left to guess: ${COUNTDOWN_TIME}s ‚è≥`;

        // Iterate over Hindi options and combine with English options
        item.options_hindi.forEach((optTextHindi, idx) => {
          const optTextEnglish = item.options_english[idx];

          const btn = document.createElement("button");
          btn.className = "opt disabled"; // Options are disabled by default
          btn.type = "button";
          btn.setAttribute("role", "listitem");
          btn.tabIndex = -1; // Make it non-focusable

          // Combine Hindi and English text for the option button
          btn.textContent = `${optTextHindi} (${optTextEnglish})`;

          btn.dataset.index = idx;
          // No click listener added for auto-mode
          optionsEl.appendChild(btn);
        });

        // Start the 5-second timer
        startQuestionTimer();
      }

      // Disable 'Next' and 'Show Answer' buttons permanently
      nextBtn.disabled = true;
      showAnswerBtn.disabled = true;

      // 3. Call the new function to load data and then start the quiz
      loadQuestions();
    </script>
  </body>
</html>
